# Test Configuration - Uses H2 in-memory database

spring.application.name=CourierDataSimulator-Test

# =============================================================================
# H2 DATABASE FOR TESTS
# =============================================================================
spring.datasource.url=jdbc:h2:mem:testdb
spring.datasource.driver-class-name=org.h2.Driver
spring.datasource.username=sa
spring.datasource.password=

spring.jpa.database-platform=org.hibernate.dialect.H2Dialect
spring.jpa.hibernate.ddl-auto=create-drop
spring.jpa.show-sql=false

# Enable H2 console for debugging tests
spring.h2.console.enabled=true

# Let Hibernate create tables BEFORE running data scripts
spring.jpa.defer-datasource-initialization=true
spring.sql.init.mode=always
spring.sql.init.data-locations=classpath:test-data.sql

# =============================================================================
# EMBEDDED KAFKA FOR TESTS
# =============================================================================
spring.kafka.bootstrap-servers=${spring.embedded.kafka.brokers}

# Producer
spring.kafka.producer.key-serializer=org.apache.kafka.common.serialization.StringSerializer
spring.kafka.producer.value-serializer=org.springframework.kafka.support.serializer.JsonSerializer
spring.kafka.producer.properties.spring.json.add.type.headers=true

# Consumer
spring.kafka.consumer.group-id=test-consumer-group
spring.kafka.consumer.key-deserializer=org.apache.kafka.common.serialization.StringDeserializer
spring.kafka.consumer.value-deserializer=org.springframework.kafka.support.serializer.JsonDeserializer
spring.kafka.consumer.auto-offset-reset=earliest
spring.kafka.consumer.properties.spring.json.trusted.packages=*

# Kafka Streams (disabled for tests to avoid conflicts)
spring.kafka.streams.auto-startup=false

# =============================================================================
# CUSTOM APPLICATION PROPERTIES
# =============================================================================
# Kafka Topics
app.kafka.topics.cdc-packages=test-cdc-packages
app.kafka.topics.mapped-packages=test-cdc-mapped-packages
app.kafka.topics.packages=test-packages

# Legacy partitioning config (keep for REST endpoints)
kafka.topic.packages=test-mapped-packages
kafka.topic.partitions=1
kafka.topic.replication-factor=1
kafka.partitioning.strategy=BY_ID

# Disable data generation in tests
data.generation.enabled=false

data.generation.pattern=CONSTANT
data.generation.base-rate=10
data.generation.duplicate-rate=0.05
data.generation.error-rate=0.02
data.generation.delay-probability=0.10
data.generation.max-delay-seconds=5
data.generation.cancellation-rate=0.15
data.generation.completion-rate=0.80

# Ingestion Strategy Configuration
ingestion.strategy=MICROBATCH
ingestion.batch.interval-minutes=5
ingestion.batch.max-size=1000
ingestion.microbatch.interval-seconds=1
ingestion.microbatch.max-size=100
ingestion.streaming.enabled=true
ingestion.streaming.async=true

# Data Generator Config
app.data-generator.batch-size=100
app.data-generator.delay-ms=1000

# Performance Monitoring
metrics.enabled=true
metrics.log-interval-seconds=30
performance.track-latency=true
performance.track-throughput=true
performance.track-resource-usage=true

# =============================================================================
# LOGGING
# =============================================================================
logging.level.root=WARN
logging.level.com.ekasikci.courierdatasimulator=INFO
logging.level.org.springframework.kafka=WARN
logging.level.org.apache.kafka=WARN
logging.level.org.hibernate.SQL=INFO